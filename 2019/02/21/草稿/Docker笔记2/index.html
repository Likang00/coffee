<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		Docker笔记2 | 
	 
	coffee
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/coffee/favicon.ico">
	
  

	
<link rel="stylesheet" href="/coffee/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/coffee/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
	<header id="header">
    <a id="title" href="/coffee/" class="logo">
        coffee
    </a>

    <ul id="menu">
        <li class="menu-item">
            <a href="/about" class="menu-item-link">ABOUT</a>
        </li>

        <!-- <li class="menu-item">
			<a href="https://github.com/wujun234/uid-generator-spring-boot-starter" class="menu-item-link" target="_blank">
				UidGenerator
			</a>
		</li> -->

        <li class="menu-item">
            <a href="https://github.com/wujun234" class="menu-item-link" target="_blank">
                <i class="fa fa-github fa-2x"></i>
            </a>
        </li>
    </ul>
</header>
	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01计算机组成原理
									</a>
									
							<ul>
								<li class="file">
									<a href="/coffee/2020/06/10/01%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/%E6%A6%82%E8%AE%BA/">
										概论
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										09HEXO
									</a>
									
							<ul>
								<li class="file">
									<a href="/coffee/2020/06/11/09HEXO/hexo%E4%B8%BB%E9%A2%98%E6%8E%A8%E8%8D%90/">
										hexo主题推荐
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										草稿
									</a>
									
							<ul>
								<li class="file">
									<a href="/coffee/2019/01/18/%E8%8D%89%E7%A8%BF/Docker%E7%AC%94%E8%AE%B01/">
										Docker笔记1
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/coffee/2019/02/21/%E8%8D%89%E7%A8%BF/Docker%E7%AC%94%E8%AE%B02/">
										Docker笔记2
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2018/11/24/%E8%8D%89%E7%A8%BF/MongoDB%E5%9F%BA%E7%A1%80/">
										MongoDB基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2018/12/27/%E8%8D%89%E7%A8%BF/MongoDB%E8%81%9A%E5%90%88/">
										MongoDB聚合
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2019/04/01/%E8%8D%89%E7%A8%BF/Python-pymongo/">
										Python-pymongo
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2019/02/28/%E8%8D%89%E7%A8%BF/Python-pymysql/">
										Python-pymysql
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2019/07/11/%E8%8D%89%E7%A8%BF/Python-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">
										Python-正则表达式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2019/07/08/%E8%8D%89%E7%A8%BF/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/">
										SQL必知必会
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2018/12/31/%E8%8D%89%E7%A8%BF/Win10%E5%AD%90%E7%B3%BB%E7%BB%9FWSL/">
										Win10子系统WSL
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2020/06/10/%E8%8D%89%E7%A8%BF/hello-world/">
										hello-world
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/coffee/2020/06/10/%E8%8D%89%E7%A8%BF/%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F/">
										列表推导式
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	Docker笔记2
</h1>
<div class="article-meta">
	
	<span>Likang</span>
	<span>2019-02-21 12:00:00</span>
    
		<div id="article-categories">
            
                
                    <span>
                        <i class="fa fa-folder" aria-hidden="true"></i>
                        <a href="/categories/Docker/">Docker</a>
						
                    </span>
                
            
		</div>
    
</div>

<div id="article-content">
	<h1 id="docker笔记2"><a href="#docker笔记2" class="headerlink" title="docker笔记2"></a>docker笔记2</h1><h6 id="本次实现将代码在github上托管"><a href="#本次实现将代码在github上托管" class="headerlink" title="本次实现将代码在github上托管,"></a>本次实现将代码在github上托管,</h6><h6 id="使用git命令配合docker-compose更新线上代码"><a href="#使用git命令配合docker-compose更新线上代码" class="headerlink" title="使用git命令配合docker-compose更新线上代码"></a>使用git命令配合docker-compose更新线上代码</h6><h4 id="先放上-Dockerfile-和-docker-compose-yml-后面会用到"><a href="#先放上-Dockerfile-和-docker-compose-yml-后面会用到" class="headerlink" title="先放上 Dockerfile 和 docker-compose.yml 后面会用到"></a>先放上 Dockerfile 和 docker-compose.yml 后面会用到</h4><h6 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h6><pre><code>FROM python:latest
ADD . /zlk
WORKDIR /zlk
RUN pip install -r zlkreq.txt
CMD [&quot;python&quot;, &quot;myapp.py&quot;]</code></pre><h6 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h6><pre><code>version: &#39;3&#39;
services:
  zlkweb:
    build: .
    ports:
      - &quot;80:5001&quot;
    volumes:
      - .:/zlk</code></pre><h6 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h6><p><code>docker-compose up -d</code></p>
<h6 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h6><p><code>docker-compose restart</code></p>
<hr>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker-Compose"></a>Docker-Compose</h2><h6 id="Compose-是一个用户定义和运行多个容器的-Docker-应用程序。在-Compose-中你可以使用-YAML-文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。"><a href="#Compose-是一个用户定义和运行多个容器的-Docker-应用程序。在-Compose-中你可以使用-YAML-文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。" class="headerlink" title="Compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 YAML 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。"></a>Compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 YAML 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动你配置的所有服务。</h6><h6 id="使用-Compose-基本会有如下三步流程："><a href="#使用-Compose-基本会有如下三步流程：" class="headerlink" title="使用 Compose 基本会有如下三步流程："></a>使用 Compose 基本会有如下三步流程：</h6><h6 id="在-Dockfile-中定义你的应用环境，使其可以在任何地方复制。"><a href="#在-Dockfile-中定义你的应用环境，使其可以在任何地方复制。" class="headerlink" title="在 Dockfile 中定义你的应用环境，使其可以在任何地方复制。"></a>在 Dockfile 中定义你的应用环境，使其可以在任何地方复制。</h6><h6 id="在-docker-compose-yml-中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。"><a href="#在-docker-compose-yml-中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。" class="headerlink" title="在 docker-compose.yml 中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。"></a>在 docker-compose.yml 中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行。</h6><h6 id="最后，运行dcoker-compose-up，Compose-将启动并运行整个应用程序。"><a href="#最后，运行dcoker-compose-up，Compose-将启动并运行整个应用程序。" class="headerlink" title="最后，运行dcoker-compose up，Compose 将启动并运行整个应用程序。"></a>最后，运行dcoker-compose up，Compose 将启动并运行整个应用程序。</h6><h4 id="我的准备工作"><a href="#我的准备工作" class="headerlink" title="我的准备工作"></a>我的准备工作</h4><p>0.1购买云服务器 安装SSH远程终端工具<br>我使用的云服务器是 腾讯云<br>云主机使用的系统是 CentOS<br>SSH使用 Xshell6</p>
<p>0.2.将想要部署的项目上传到github上<br>本次使用的项目是 图灵程序设计丛书 Flask Web 开发中的项目<br>项目地址:<br><a href="https://github.com/miguelgrinberg/flasky" target="_blank" rel="noopener">https://github.com/miguelgrinberg/flasky</a></p>
<p>我的github项目地址:<br>(暂时有个人配置 后续修改后放上来)</p>
<p>0.3确认你已经云服务器中安装了 Docker 与 Docker Compose<br>上篇已经介绍过 这次略过</p>
<pre><code>yum install -y docker # 安装docker
systemctl start docker # 启动docker
docker search python # 查找python镜像
docker pull python # 拉取镜像
docker run -it python &quot;/bin/bash&quot;

python -V
pip -V
pip list
pip install xxx
exit

docker commit xxxxxxxxxxxx(上面的镜像编号) python:latest # 保存自己的python镜像</code></pre><h4 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h4><p>1 定义应用依赖<br>建文件夹cd进去<br>git clone xxx 拉代码<br>git checkout xxx 切换到指定分支</p>
<p>2 创建 Dockerfile<br>在你的项目路径下创建一个 Dockerfile 文件<br>在工作路径下创建一个叫做 docker-compose.yml<br>编辑 Compose 文件添加一个绑定挂载<br>这个新的 volumes 键将当前路径（项目路径）与容器中的 /code 路径挂载到一起，允许你及时修改代码而不用重新构建镜像。(关键)<br>(需要修改文件 因为git中拉下来是我的配置)<br>你也可以通过 docker inspect <tag or id> 来检查镜像。</tag></p>
<p>3 运行项目​<br>如果你希望你的应用程序在后台运行，你可以将 -d 标记传递给 docker-compose up 并使用<br>docker-compose up -d</p>
<p>4 更新项目并重新部署<br>因为应用程序的代码通过 volume 挂载到容器中，你可以更改其代码并立即查看更改，而不必重新生成镜像。<br>只用在你的个人电脑上连接github 修改后<br>在云服务器项目目录下<br><strong>git pull</strong><br><strong>docker-compose restart</strong></p>
<p>ok!</p>
<h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><h4 id="docker-compose-在dockerfile更新后自动更新image"><a href="#docker-compose-在dockerfile更新后自动更新image" class="headerlink" title="docker-compose 在dockerfile更新后自动更新image"></a>docker-compose 在dockerfile更新后自动更新image</h4><pre><code>比如在dockerfile里需要新安装包
RUN pip install XXX
之后,希望docker-compose能更新镜像, 然后启动容器
只需要启动时使用 --build即可:

docker-compose stop
docker-compose up -d --build</code></pre><pre><code>更新镜像时
这样执行 docker-compose 命令
docker-compose pull &amp;&amp; docker-compose up --force-recreate -d
试试 docker-compose.yml 添加如下的配置
services:
  web:
    deploy:
      update_config:
        order: start-first</code></pre>
</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/coffee/2019/02/28/%E8%8D%89%E7%A8%BF/Python-pymysql/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  Python-pymysql
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/coffee/2019/01/18/%E8%8D%89%E7%A8%BF/Docker%E7%AC%94%E8%AE%B01/">
                Docker笔记1
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">Likang</a> 
	
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>